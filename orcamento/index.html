<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Or√ßamentos - Relevo</title>

  <!-- √çcone -->
  <link rel="icon" type="image/png"
        href="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/favicon_menos.png" />

  <!-- üîê Pol√≠tica de seguran√ßa atualizada para liberar securetoken -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https://*.firebaseapp.com https://firestore.googleapis.com https://*.firebaseio.com https://www.googleapis.com;
    script-src 'self' 'unsafe-eval' 'unsafe-inline' https://www.gstatic.com https://apis.google.com https://www.googleapis.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' https://securetoken.googleapis.com https://firestore.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://identitytoolkit.googleapis.com;
    img-src 'self' data: https:;
  " />

  <!-- ‚úÖ Firebase SDK compat (usa o mesmo do portal) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

  <!-- ‚úÖ Usa a inicializa√ß√£o j√° existente do portal -->
  <script src="../scripts/firebase-init-guard.js"></script>

  <!-- üîÑ Espelho do usu√°rio autenticado -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      if (window.firebase && firebase.auth) {
        window.relevoUser = firebase.auth().currentUser || null;
        firebase.auth().onAuthStateChanged(u => {
          window.relevoUser = u || null;
          console.log("üîó Or√ßamento conectado ao usu√°rio do portal:", u ? u.email : "nenhum");
        });
      } else {
        console.warn("‚ö†Ô∏è Firebase n√£o detectado no or√ßamento. Verifique o guard.");
      }
    });
  </script>

  <!-- üß† App React (build do Vite) -->
  <script type="module" crossorigin src="/orcamento/assets/index-f3424957.js"></script>
  <link rel="stylesheet" href="/orcamento/assets/index-be086e8e.css" />

  <!-- üåø Floresta √ömida: fontes + tema Relevo -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="./relevo-theme.css" />
</head>

<body>
  <!-- üîπ Estrutura visual padr√£o Relevo 2025 -->
  <div id="root">
    <header class="relevo-header">
      <div class="relevo-container">
        <h1 class="relevo-title">Gest√£o de Or√ßamentos</h1>
      </div>
    </header>

    <main class="relevo-container">
      <!-- KPIs -->
      <section class="relevo-kpis">
        <div class="relevo-card relevo-kpi">
          <div class="label">Or√ßamentos Ativos</div>
          <div class="value" id="kpiAtivos">--</div>
        </div>
        <div class="relevo-card relevo-kpi">
          <div class="label">Em Aprova√ß√£o</div>
          <div class="value" id="kpiAprovacao">--</div>
        </div>
        <div class="relevo-card relevo-kpi">
          <div class="label">Aprovados</div>
          <div class="value" id="kpiAprovados">--</div>
        </div>
        <div class="relevo-card relevo-kpi">
          <div class="label">Valor Total (R$)</div>
          <div class="value" id="kpiValor">--</div>
        </div>
      </section>

      <!-- Filtros -->
      <section class="relevo-card">
        <div class="relevo-filtros">
          <input
            id="filtroBusca"
            type="search"
            placeholder="Buscar por cliente / proposta"
          />
          <select id="filtroStatus">
            <option value="">Status</option>
            <option value="rascunho">Rascunho</option>
            <option value="em_aprovacao">Em aprova√ß√£o</option>
            <option value="aprovado">Aprovado</option>
          </select>
          <select id="filtroPeriodo">
            <option value="">Per√≠odo</option>
            <option value="30">√öltimos 30 dias</option>
            <option value="90">√öltimos 90 dias</option>
            <option value="365">√öltimos 12 meses</option>
          </select>
        </div>

        <!-- Tabela -->
        <div class="relevo-table-wrap">
          <table class="relevo-table" id="tabelaOrcamentos">
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>Cliente</th>
                <th>T√≠tulo</th>
                <th>Status</th>
                <th>Valor (R$)</th>
                <th>Atualizado em</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <!-- preenchido via Firestore -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="relevo-footer">
      <div class="relevo-container">
        Relevo Consultoria Ambiental ‚Äî Intranet
      </div>
    </footer>
  </div>

  <!-- ‚úÖ Scripts mantidos intactos -->
</body>
</html>

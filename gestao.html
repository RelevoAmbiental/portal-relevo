<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gest√£o Interna | Relevo Consultoria Ambiental</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/favicon_menos.png">

  <!-- Fontes e √çcones -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- CSS Global -->
  <link rel="stylesheet" href="styles/global.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

  <!-- Guard unificado -->
  <script src="scripts/firebase-init-guard.js"></script>

  <style>
    /* --- estilos (mantidos exatamente como voc√™ enviou) --- */
    .hero-gestao {
      background: linear-gradient(135deg, var(--verde-primario) 0%, var(--verde-escuro) 100%);
      color: white;
      padding: 50px 30px;
      margin-bottom: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }

    .hero-gestao::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url('https://raw.githubusercontent.com/RelevoAmbiental/imagens/main/DSC_0842.JPG') center/cover;
      opacity: 0.1;
    }

    .hero-gestao > * { position: relative; z-index: 1; }

    .hero-gestao .logo { height: 60px; margin-bottom: 20px; filter: brightness(0) invert(1); }

    .hero-gestao h1 {
      color: white;
      font-size: 2.5rem;
      margin-bottom: 15px;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .hero-gestao p {
      font-size: 1.2rem;
      opacity: 0.95;
      max-width: 600px;
      margin: 0 auto;
    }

    .section { margin-bottom: 50px; }

    .section-title {
      color: var(--verde-accent);
      margin-bottom: 30px;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 15px;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 4px;
      background: var(--verde-primario);
      border-radius: 2px;
    }

    .access-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .access-card {
      background: var(--card-branco);
      border-radius: 12px;
      padding: 30px 25px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      border-left: 4px solid var(--verde-primario);
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      height: 100%;
      transition: .3s ease;
    }

    .access-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }

    .despesas-destaque {
      background: linear-gradient(135deg, #f8fff8, #e8f5e9);
      border: 2px dashed var(--verde-primario);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      margin: 30px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    .dashboard-card {
      background: var(--card-branco);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      border-left: 4px solid var(--laranja);
      display: flex;
      flex-direction: column;
      min-height: 360px;
    }

    .two-col-dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      width: 100%;
    }

    .four-col-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 25px;
      width: 100%;
      margin: 30px 0;
    }

    .mini-calendar-placeholder {
      border-radius: 12px;
      padding: 15px;
      border: 1px dashed var(--borda-cinza);
      background: #fafafa;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/Logo_atualizada_vertical.png"
           alt="Logo Relevo Consultoria Ambiental"
           class="logo">

      <button class="menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
        <i class="fas fa-bars"></i>
      </button>

      <nav class="nav-links" id="navLinks">
        <a href="gestao.html"><i class="fas fa-chart-line"></i> Gest√£o</a>
        <a href="colaboradores.html"><i class="fas fa-users"></i> Equipe</a>
        <a href="clientes.html"><i class="fas fa-briefcase"></i> Clientes</a>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Sair
        </button>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero-gestao">
    <div class="container">
      <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/Logo_atualizada_horizontal.png"
           alt="Relevo Consultoria Ambiental"
           class="logo">

      <h1>Gest√£o Interna</h1>
      <p>Central de controle e informa√ß√µes administrativas da Relevo Consultoria Ambiental</p>
    </div>
  </section>

  <main class="container">

    <!-- ACESSO R√ÅPIDO -->
    <section class="section">
      <h2 class="section-title">Acesso R√°pido</h2>

      <div class="access-grid">

        <a href="https://drive.google.com/drive/folders/1S6JDVXcLChU-Tm4MESNgDQEz_zPRh5go?usp=drive_link"
           target="_blank" class="access-card">
          <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/arquivos.png" alt="">
          <h3>Drive da Empresa</h3>
          <p>Acesso aos documentos corporativos e recursos internos.</p>
          <span class="btn btn-primary">Acessar Drive</span>
        </a>

        <a href="https://drive.google.com/drive/folders/1yeL1JVgOQquw33ypUFv9wjMtHKxBd1RL?usp=drive_link"
           target="_blank" class="access-card">
          <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/compartilhados.png" alt="">
          <h3>Relat√≥rios de Clientes</h3>
          <p>Documenta√ß√£o t√©cnica e relat√≥rios entregues.</p>
          <span class="btn btn-primary">Visualizar Relat√≥rios</span>
        </a>

        <a href="https://drive.google.com/drive/folders/1S6JDVXcLChU-Tm4MESNgDQEz_zPRh5go?usp=drive_link"
           target="_blank" class="access-card">
          <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/SegurancaJuridica.png" alt="">
          <h3>SST e Seguran√ßa</h3>
          <p>Procedimentos de sa√∫de e seguran√ßa no trabalho.</p>
          <span class="btn btn-primary">Acessar SST</span>
        </a>

        <a href="https://docs.google.com/spreadsheets/d/10LJopYBh7cSrD_e0gr1iMw_BcVzrcAdreXfTRzvWPps/edit?usp=sharing"
           target="_blank" class="access-card">
          <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/Gastos.png" alt="">
          <h3>Controle de Propostas</h3>
          <p>Acompanhamento e gest√£o das propostas da empresa.</p>
          <span class="btn btn-primary">Ver Planilha</span>
        </a>
      </div>

      <div class="despesas-destaque">
        <h3><i class="fas fa-receipt"></i> Registrar despesa</h3>
        <p>Cadastro de despesas de campo, viagens e atividades internas.</p>
        <a class="btn btn-primary" href="despesas">
          <i class="fas fa-plus-circle"></i> Cadastrar Nova Despesa
        </a>
      </div>

      <!-- Linha com quatro m√≥dulos -->
      <div class="four-col-dashboard">

        <!-- Despesas -->
        <div class="dashboard-card">
          <div>
            <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/Gastos.png" alt="">
            <h3>üìä Gest√£o de Despesas</h3>
            <p>Painel completo para visualizar e analisar despesas j√° registradas.</p>
          </div>
          <a class="btn btn-orange" href="gestao-despesas.html">
            <i class="fas fa-chart-pie"></i> Abrir Painel de Despesas
          </a>
        </div>

        <!-- Or√ßamentos -->
        <div class="dashboard-card">
          <div>
            <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/orcamento.png" alt="">
            <h3>üíº Gest√£o de Or√ßamentos</h3>
            <p>Centraliza√ß√£o e controle dos or√ßamentos gerados pela equipe.</p>
          </div>
          <a class="btn btn-orange" href="https://portal.relevo.eco.br/orcamento/" target="_blank">
            <i class="fas fa-file-invoice-dollar"></i> Acessar Portal de Or√ßamentos
          </a>
        </div>

        <!-- Cronograma -->
        <div class="dashboard-card">
          <div>
            <img src="https://raw.githubusercontent.com/RelevoAmbiental/relevo-site/refs/heads/main/assets/icons/cronograma.png" alt="">
            <h3>üóìÔ∏è Agenda de Projetos</h3>
            <p>Visualiza√ß√£o de todas as etapas e prazos dos projetos.</p>
          </div>
          <a class="btn btn-orange" href="https://portal.relevo.eco.br/cronograma/" target="_blank">
            <i class="fas fa-calendar-alt"></i> Abrir Agenda
          </a>
        </div>

        <!-- Invent√°rio -->
        <div class="dashboard-card">
          <div>
            <img src="https://raw.githubusercontent.com/RelevoAmbiental/portal-relevo/refs/heads/main/styles/icons/Inventario_equipos.png" alt="">
            <h3>üì¶ Invent√°rio de Equipamentos</h3>
            <p>Cadastro e monitoramento da movimenta√ß√£o de equipamentos.</p>
          </div>
          <a class="btn btn-orange" href="inventario/">
            <i class="fas fa-warehouse"></i> Acessar Invent√°rio
          </a>
        </div>

      </div>
    </section>

    <!-- DASHBOARD DE INDICADORES -->
    <section class="section">
      <h2 class="section-title">Dashboard de Indicadores</h2>

      <div class="clickup-container">
        <div class="two-col-dashboard">

          <!-- Indicadores de tarefas -->
          <div class="dashboard-card">
            <div>
              <img src="https://raw.githubusercontent.com/RelevoAmbiental/portal-relevo/refs/heads/main/styles/icons/Tarefas.png" alt=""
                   style="width:100px; height:80px; object-fit:contain; margin-bottom:15px;">
              <h3>Resumo de Tarefas</h3>
              <p>Vis√£o geral do andamento dos projetos. Dados v√™m do m√≥dulo Cronograma.</p>
            </div>

            <ul class="indicators-list">
              <li><span class="label">Tarefas pendentes</span><span class="value">‚Äî</span></li>
              <li><span class="label">Em andamento</span><span class="value">‚Äî</span></li>
              <li><span class="label">Atrasadas</span><span class="value">‚Äî</span></li>
              <li><span class="label">Conclu√≠das</span><span class="value">‚Äî</span></li>
            </ul>
          </div>

          <!-- Agenda da semana -->
          <div class="dashboard-card">
            <div>
              <img src="https://raw.githubusercontent.com/RelevoAmbiental/portal-relevo/refs/heads/main/styles/icons/agenda.png" alt=""
                   style="width:100px; height:80px; object-fit:contain; margin-bottom:15px;">
              <h3>Agenda da Semana</h3>
              <p>Principais entregas previstas para os pr√≥ximos dias.</p>
            </div>

            <div class="mini-calendar-placeholder">
              <p><strong>Hoje:</strong> ‚Äî</p>
              <p><strong>Pr√≥ximas entregas (7 dias):</strong></p>
              <ul></ul>
              <small>Em breve preenchido automaticamente pelo Cronograma.</small>
            </div>
          </div>

        </div>
      </div>
    </section>

  </main>

  <footer>
    ¬© 2025 Relevo Consultoria Ambiental ‚Äî Todos os direitos reservados.
  </footer>

  <!-- ==========================================================
       SCRIPT CONSOLIDADO (AUTENTICA√á√ÉO + CRONOGRAMA)
       ========================================================== -->
  <script>
    /* ==========================================
       AUTH DO PORTAL
       ========================================== */
    const auth = window.__RELEVO_AUTH__ || firebase.auth();

    if (auth?.onAuthStateChanged) {
      auth.onAuthStateChanged((user) => {
        if (!user) {
          console.log("‚ùå Usu√°rio n√£o autenticado ‚Äî Redirecionando‚Ä¶");
          window.location.href = "index.html";
        } else {
          console.log("‚úÖ Usu√°rio autenticado:", user.email);
        }
      });
    }

    function logout() {
      if (!auth) return;
      if (confirm("Deseja mesmo sair?")) {
        auth.signOut().then(() => {
          window.location.href = "index.html";
        });
      }
    }

    /* ==========================================
       MENU MOBILE
       ========================================== */
    function toggleMobileMenu() {
      const nav = document.getElementById("navLinks");
      nav.classList.toggle("mobile-open");
    }

    document.querySelectorAll(".nav-links a").forEach(a => {
      a.addEventListener("click", () => {
        document.getElementById("navLinks").classList.remove("mobile-open");
      });
    });

    /* ==========================================
       INTEGRA√á√ÉO COM CRONOGRAMA
       ========================================== */

    async function carregarIndicadoresCronograma() {
      if (!window.__RELEVO_DB__ || !window.__RELEVO_USER__) {
        console.warn("‚è≥ Portal aguardando inicializar DB/USER‚Ä¶");
        return;
      }

      const db = window.__RELEVO_DB__;
      const user = window.__RELEVO_USER__;

      try {
        const snap = await db
          .collection("tasks")
          .where("userId", "==", user.uid)
          .get();

        const tarefas = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        atualizarDashboardTarefas(tarefas);
        atualizarAgendaSemanal(tarefas);

      } catch (err) {
        console.error("‚ùå Erro lendo tasks:", err);
      }
    }

    function atualizarDashboardTarefas(tarefas) {
      const pend = tarefas.filter(t => t.status === "pendente").length;
      const anda = tarefas.filter(t => t.status === "andamento").length;
      const atr  = tarefas.filter(t => t.status === "atrasada").length;
      const conc = tarefas.filter(t => t.status === "concluida").length;

      const vals = document.querySelectorAll(".indicators-list .value");
      vals[0].textContent = pend;
      vals[1].textContent = anda;
      vals[2].textContent = atr;
      vals[3].textContent = conc;
    }

    function atualizarAgendaSemanal(tarefas) {
      const hoje = new Date();
      const fim = new Date();
      fim.setDate(hoje.getDate() + 7);

      const proximas = tarefas
        .filter(t => t.dueDate)
        .filter(t => {
          const d = new Date(t.dueDate);
          return d >= hoje && d <= fim;
        })
        .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

      const ul = document.querySelector(".mini-calendar-placeholder ul");
      ul.innerHTML = "";

      if (proximas.length === 0) {
        ul.innerHTML = "<li>Sem entregas nos pr√≥ximos 7 dias</li>";
        return;
      }

      proximas.forEach(t => {
        const d = new Date(t.dueDate).toLocaleDateString("pt-BR", { day: "2-digit", month: "2-digit" });
        ul.innerHTML += `<li>${d} ‚Äî ${t.nome || "Entrega sem nome"}</li>`;
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        console.log("üì° Sincronizando com m√≥dulo Cronograma‚Ä¶");
        carregarIndicadoresCronograma();
      }, 800);
    });
  </script>

</body>
</html>
